<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="fontawesome/fontawesome-free-6.3.0-web/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/create_news.css">
    <title>Phê duyệt video</title>
</head>

<body>
    <div>
        <div class="d-flex" style="height: 45px;">
            <div class="col-2 d-flex px-3 align-items-center fs-5" style="background-color: rgb(41, 41, 41);">
                <a class="navbar-brand fw-bold" style="color: #ff6200;" href="/">FNEWS</a>
            </div>
            <div class="col-10 p-0 d-flex" style="background-color: rgb(72, 72, 72);"></div>
        </div>
        <div id="news-box" class="container">
            <p class="fs-4 fw-bolder mt-3 p-0">Phê duyệt video</p>
            <input type="hidden" value="<%=id%>" id="video-id">

            <div class="d-flex mb-4 pt-4 border-top" style="width: 100%; border-color: #232323;">
                <div style="width: 100%;" class="d-flex flex-column">
                    <p id="news-title" class=" me-3 fw-bold fs-5 text"
                        style="font-family: 'Times New Roman', Times, serif; -webkit-line-clamp: 3; line-clamp: 3;">
                    </p>
                    <p class=" my-1 fw-bolder">Trạng thái: <span id="video-state" class="fw-normal ms-2"></span>
                    </p>
                    <p class=" my-1 fw-bolder">Bài viết liên quan: <a href="#" id="video-linkedNews"
                            class="fw-normal ms-2"></a></p>
                    <p class=" my-1 fw-bolder">Người dùng: <a href="#" id="video-author"
                            class="fw-normal ms-2"></a></p>
                </div>
            </div>

            <h4 class="my-3">Video</h4>
            <div class="border border-1 border-dark p-5">
                <iframe id="video-content" width="100%" height="700px" src="https://www.youtube.com/embed/${content}">
                </iframe>
            </div>

            <div id="news-review-form" class="d-flex flex-column">
                <div class="mb-3">
                    <label for="#" class="my-2 fw-bold">Phê duyệt video</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="new-video-state" id="flexRadioDefault1"
                            value="1">
                        <label class="form-check-label" for="flexRadioDefault1">
                            Phê duyệt
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="new-video-state" id="flexRadioDefault2"
                            value="0">
                        <label class="form-check-label" for="flexRadioDefault2">
                            Chưa phê duyệt
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="new-video-state" id="flexRadioDefault3"
                            value="2">
                        <label class="form-check-label" for="flexRadioDefault3">
                            Từ chối phê duyệt
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="video-state-extra" class="form-label fw-bold">Lý do phê duyệt hoặc từ
                        chối</label>
                    <textarea class="form-control" id="video-state-extra" rows="3"></textarea>
                </div>
                <button class="btn btn-success mb-3" style="width: 100px;" onclick="reviewNews()">Lưu</button>
                <p class="my-4" id="inform"></p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="modalCenter" tabindex="-1" role="dialog" aria-labelledby="emodalCenterTitle"
        data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="emodalCenterTitle">Phê duyệt video</h5>
                </div>
                <div class="modal-body text-success">
                    <h5>Phê duyệt video thành công.</h5>
                </div>
                <div class="modal-footer">
                    <a href="/video-management" type="button" class="btn btn-secondary" data-dismiss="modal">Trở về
                        trang quản lý video</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/super-build/ckeditor.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="/javascripts/show_addmin_board.js"></script>
    <script>

        $.ajax({
            url: "/video/" + $('#video-id').val(),
            type: "GET",
            dataType: "json",
            success: function (data) {
                if (data.success) {
                    console.log(data)

                    const content = data.data.content.split('/')[3]
                    $('#video-content').attr('src', `https://www.youtube.com/embed/${content}`)
                    $('#news-title').text(data.data.title)
                    $('#video-linkedNews').text(data.data.linkedNews)
                    $('#video-linkedNews').attr('href', 'news/' + data.data.linkedNews)


                    $('#video-author').text(data.data.onwer.display_name)
                    $('#video-author').attr('href', '/user-detail/' + data.data.onwer._id)

                    const state = data.data.state
                    if (state == 0) {
                        $('#video-state').text('Chưa phê duyệt')
                        $('input[type="radio"][value="0"]').prop('checked', true);
                    } else if (state == 1) {
                        $('#video-state').text('Đã phê duyệt')
                        $('input[type="radio"][value="1"]').prop('checked', true);
                    } else {
                        $('#video-state').text('Từ chối')
                        $('input[type="radio"][value="2"]').prop('checked', true);
                    }



                } else {
                    console.log(data.message)
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                console.error("Yêu cầu thất bại: " + textStatus + ", " + errorThrown);
            }
        });

        function reviewNews() {
            const state = $('input[name=new-video-state]:checked').val()
            const stateExtra = $('textarea').val()

            console.log(state + "-" + stateExtra)

            if (!state) {
                $('#inform').text("Vui lòng chọn trạng thái!")
                return
            }

            if (stateExtra == "" || state == null) {
                $('#inform').text("Vui lòng điền nhận xét")
                return
            }

            $.ajax({
                url: "/video/",
                type: "PUT",
                beforeSend: function (request) {
                    console.log("Bearer " + getCookie("Authorization"))
                    request.setRequestHeader("Authorization", "Bearer " + getCookie("Authorization"));
                },
                dataType: "json",
                data: { id: $('#video-id').val(), state: state, stateExtra: stateExtra },
                success: function (data) {
                    if (data.success) {
                        $('#modalCenter').modal('show')
                    } else {
                        console.log(data.message)
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.error("Yêu cầu thất bại: " + textStatus + ", " + errorThrown);
                }
            });
        }

    </script>
</body>

</html>